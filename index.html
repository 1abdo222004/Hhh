<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telephone=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="MobileOptimized" content="176" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="robots" content="noindex,nofollow" />
    <script src="https://telegram.org/js/telegram-web-app.js?2"></script>
    <script>
        function setThemeClass() {
            document.documentElement.className = Telegram.WebApp.colorScheme;
        }

        Telegram.WebApp.onEvent('themeChanged', setThemeClass);
        setThemeClass();

    </script>
    <title>Telegram WebApp Demo</title>
    <style>
        body {
            --bg-color: var(--tg-theme-bg-color, #fff);
            font-family: sans-serif;
            background-color: var(--bg-color);
            color: var(--tg-theme-text-color, #222);
            font-size: 14px;
            margin: 0;
            padding: 0;
            color-scheme: var(--tg-color-scheme);
        }

        body.gray {
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
        }

        a {
            color: var(--tg-theme-link-color, #2481cc);
        }

        button,
        input[type=submit] {
            display: block;
            width: 100%;
            font-size: 14px;
            padding: 8px 12px;
            margin-bottom: 8px;
            border-radius: 4px;
            border: none;
            background: var(--tg-theme-button-color, #337ab7);
            color: var(--tg-theme-button-text-color, #fff);
            cursor: pointer;
        }

        button:active {
            opacity: 0.8;
        }

        button.destructive {
            background: #dc3545;
        }

        button.success {
            background: #28a745;
        }

        button.outline {
            background: transparent;
            color: var(--tg-theme-button-color, #337ab7);
            border: 1px solid var(--tg-theme-button-color, #337ab7);
        }

        button.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        input[type=text],
        input[type=number] {
            display: block;
            width: 100%;
            font-size: 14px;
            padding: 8px 12px;
            margin-bottom: 8px;
            border-radius: 4px;
            border: 1px solid var(--tg-theme-secondary-bg-color, #e7e7e7);
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            color: var(--tg-theme-text-color, #222);
            box-sizing: border-box;
            -webkit-appearance: none;
        }

        input[type=text]:focus,
        input[type=number]:focus {
            border-color: var(--tg-theme-link-color, #2481cc);
            outline: none;
        }

        textarea {
            display: block;
            width: 100%;
            font-size: 14px;
            padding: 8px 12px;
            margin-bottom: 8px;
            border-radius: 4px;
            border: 1px solid var(--tg-theme-secondary-bg-color, #e7e7e7);
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            color: var(--tg-theme-text-color, #222);
            box-sizing: border-box;
            -webkit-appearance: none;
            min-height: 80px;
            resize: vertical;
        }

        .container {
            padding: 16px;
        }

        .section-header {
            font-size: 13px;
            font-weight: 500;
            color: var(--tg-theme-hint-color, #8e8e93);
            margin-top: 16px;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .section-header:first-child {
            margin-top: 0;
        }

        .row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--tg-theme-secondary-bg-color, #e7e7e7);
        }

        .row:last-child {
            border-bottom: none;
        }

        .row strong {
            font-weight: 500;
        }

        .row a {
            text-decoration: none;
        }

        .row input[type=checkbox] {
            margin-right: 8px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input[type=color] {
            width: 40px;
            height: 40px;
            border: none;
            padding: 0;
            margin: 0;
            cursor: pointer;
            vertical-align: middle;
            -webkit-appearance: none;
        }

        .form-group input[type=color]::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        .form-group input[type=color]::-webkit-color-swatch {
            border: none;
            border-radius: 4px;
        }

        .header-widget {
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            color: var(--tg-theme-text-color, #222);
            padding: 16px;
            font-size: 18px;
            font-weight: 500;
            text-align: center;
            line-height: 1.2;
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);
        }

        .bottom-bar-widget {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bottom-bar-color, var(--tg-theme-secondary-bg-color, #f0f0f0));
            color: var(--tg-theme-text-color, #222);
            padding: 16px;
            font-size: 18px;
            font-weight: 500;
            text-align: center;
            line-height: 1.2;
            box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.1);
        }

        .placeholder {
            min-height: 30px;
            border: 1px dashed var(--tg-theme-hint-color, #8e8e93);
            border-radius: 4px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: var(--tg-theme-hint-color, #8e8e93);
            text-align: center;
            line-height: 1.5;
            padding: 8px;
            box-sizing: border-box;
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            min-height: 50px;
        }

        [contenteditable]:focus {
            outline: none;
        }

        [contenteditable]:empty:before {
            content: attr(data-placeholder);
            color: var(--tg-theme-hint-color, #8e8e93);
        }

        .clipboard-test-result {
            margin-top: 8px;
            font-weight: bold;
            color: var(--tg-theme-link-color, #2481cc);
        }

        .cloud-storage-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
        }

        .cloud-storage-table th,
        .cloud-storage-table td {
            padding: 8px;
            border: 1px solid var(--tg-theme-secondary-bg-color, #e7e7e7);
            text-align: left;
        }

        .cloud-storage-table th {
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
        }

        .cloud-storage-table .actions button {
            width: auto;
            display: inline-block;
            margin-right: 4px;
            padding: 4px 8px;
        }

        .biometric-status-item {
            margin-bottom: 4px;
        }

        .biometric-status-item strong {
            margin-right: 8px;
        }

        .activity-item {
            margin-bottom: 4px;
        }
    </style>
</head>
<body class="" style="visibility: hidden;">
    <div class="header-widget" id="header_widget"></div>

    <div class="container">
        <div class="section-header">Telegram Web Apps Demo</div>

        <div class="row">
            <strong>Query ID:</strong>
            <span id="query_id_display"></span>
        </div>
        <div class="row">
            <strong>Auth Date:</strong>
            <span id="auth_date_display"></span>
        </div>
        <div class="row">
            <strong>Signature:</strong>
            <span id="signature_display"></span>
        </div>
        <div class="row">
            <strong>Hash:</strong>
            <span id="hash_display"></span>
        </div>

        <div class="section-header">User Information</div>
        <div class="row">
            <strong>User ID:</strong>
            <span id="user_id"></span>
        </div>
        <div class="row">
            <strong>First Name:</strong>
            <span id="user_first_name"></span>
        </div>
        <div class="row">
            <strong>Last Name:</strong>
            <span id="user_last_name"></span>
        </div>
        <div class="row">
            <strong>Username:</strong>
            <span id="user_username"></span>
        </div>
        <div class="row">
            <strong>Language Code:</strong>
            <span id="user_language_code"></span>
        </div>
        <div class="row">
            <strong>Allows Write to PM:</strong>
            <span id="user_allows_write_to_pm"></span>
        </div>
        <div class="row">
            <strong>Photo URL:</strong>
            <span id="user_photo_url"></span>
        </div>
        <div class="row">
            <strong>Is Premium:</strong>
            <span id="user_is_premium"></span>
        </div>
        <div class="row">
            <strong>Added To Attachment Menu:</strong>
            <span id="user_added_to_attachment_menu"></span>
        </div>

        <div class="section-header">Other Web App Data</div>
        <div class="row">
            <strong>Init Data Unsafe (Full):</strong>
            <span id="init_data_unsafe"></span>
        </div>
        <div class="row">
            <strong>Theme Params:</strong>
            <span id="theme_params"></span>
        </div>
        <div class="row">
            <strong>Version:</strong>
            <span id="web_app_version"></span>
        </div>
        <div class="row">
            <strong>Platform:</strong>
            <span id="web_app_platform"></span>
        </div>
        <div class="row">
            <strong>Header Color:</strong>
            <input type="text" id="header_color_input" value="#ffffff">
            <input type="color" id="header_color_picker" value="#ffffff">
        </div>
        <div class="row">
            <strong>Bottom Bar Color:</strong>
            <input type="text" id="bottom_bar_color_input" value="#ffffff">
            <input type="color" id="bottom_bar_color_picker" value="#ffffff">
        </div>
        <div class="row">
            <strong>Background Color:</strong>
            <input type="text" id="bg_color_input" value="#ffffff">
        </div>
        <div class="row">
            <strong>Is Vertical Swipes Enabled:</strong>
            <span id="vertical_swipes_enabled"></span>
            <button id="disable_vertical_swipes_btn">Disable Vertical Swipes</button>
        </div>
        <div class="row">
            <strong>Is Expanded:</strong>
            <span id="is_expanded"></span>
        </div>
        <div class="row">
            <strong>Viewport Height:</strong>
            <span id="viewport_height"></span>
        </div>
        <div class="row">
            <strong>Viewport Stable Height:</strong>
            <span id="viewport_stable_height"></span>
        </div>
        <div class="row">
            <strong>Is Closing Confirmation Enabled:</strong>
            <span id="closing_confirmation"></span>
        </div>
        <div class="row">
            <strong>Is Orientation Locked:</strong>
            <span id="is_orientation_locked"></span>
            <button id="orient_btn">Lock Orientation</button>
        </div>
        <div class="row">
            <strong>Is Inited:</strong>
            <span id="is_inited"></span>
        </div>
        <div class="row">
            <strong>Main Button Text:</strong>
            <input type="text" id="main_button_text_input" value="Close Webview">
            <button id="set_main_button_text">Set Main Button Text</button>
        </div>
        <div class="row">
            <strong>Main Button Visible:</strong>
            <span id="main_button_visible"></span>
            <button id="show_main_button">Show Main Button</button>
            <button id="hide_main_button">Hide Main Button</button>
        </div>
        <div class="row">
            <strong>Secondary Button Visible:</strong>
            <span id="secondary_button_visible"></span>
            <button id="show_secondary_button">Show Secondary Button</button>
            <button id="hide_secondary_button">Hide Secondary Button</button>
        </div>
        <div class="row">
            <strong>Back Button Visible:</strong>
            <span id="back_button_visible"></span>
            <button id="show_back_button">Show Back Button</button>
        </div>
        <div class="row">
            <strong>Settings Button Visible:</strong>
            <span id="settings_button_visible"></span>
            <button id="show_settings_button">Show Settings Button</button>
        </div>
        <div class="row">
            <strong>Scan QR Popup Button:</strong>
            <button id="scan_qr_btn">Show Scan QR Popup</button>
        </div>
        <div class="row">
            <strong>Custom Styles:</strong>
            <button id="set_custom_styles">Set Custom Styles</button>
            <button id="remove_custom_styles">Remove Custom Styles</button>
        </div>
        <div class="row">
            <strong>Activity:</strong>
            <div id="activity_duration"></div>
            <div id="activity_previous_duration"></div>
        </div>

        <div class="section-header">Actions</div>

        <button id="close_webview_btn">Close Webview</button>
        <button id="expand_webview_btn">Expand Webview</button>
        <button id="request_fullscreen_btn">Request Fullscreen</button>
        <button id="show_progress_btn">Show Progress</button>
        <button id="hide_progress_btn">Hide Progress</button>
        <button id="set_closing_confirmation_btn">Set Closing Confirmation</button>
        <button id="unset_closing_confirmation_btn">Unset Closing Confirmation</button>

        <div class="section-header">Clipboard</div>
        <div class="form-group">
            <label for="clipboard_text_input">Text to write to clipboard:</label>
            <input type="text" id="clipboard_text_input" value="Hello from Web App!">
            <button id="write_clipboard_btn">Write to Clipboard</button>
        </div>
        <div class="form-group">
            <label>Read from clipboard:</label>
            <button id="read_clipboard_btn">Read from Clipboard</button>
            <div id="clipboard_test" class="clipboard-test-result"></div>
        </div>

        <div class="section-header">Cloud Storage</div>
        <div id="cloud_storage_status" style="margin-bottom: 16px;"></div>
        <table class="cloud-storage-table" id="cloud_storage_table">
            <thead>
                <tr>
                    <th>Key</th>
                    <th>Value</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div class="form-group">
            <label for="cloud_storage_key">Key:</label>
            <input type="text" id="cloud_storage_key">
            <label for="cloud_storage_value">Value:</label>
            <input type="text" id="cloud_storage_value">
            <button id="cloud_storage_save_btn">Save to Cloud Storage</button>
        </div>
        <button id="cloud_storage_delete_all_btn" class="destructive">Delete All from Cloud Storage</button>
        <button id="cloud_storage_get_all_btn">Reload All Keys</button>

        <div class="section-header">Biometrics</div>
        <div id="biometric_status"></div>
        <button id="biometric_request_access_btn">Request Access</button>
        <button id="biometric_authenticate_btn">Authenticate</button>
        <button id="biometric_open_settings_btn">Open Settings</button>
        <button id="biometric_set_token_btn">Set Token</button>
        <button id="biometric_delete_token_btn" class="destructive">Delete Token</button>

        <div class="section-header">Permissions</div>
        <div class="form-group">
            <label>Location:</label>
            <button id="request_location_btn">Request Location</button>
            <div id="location_data" class="placeholder">Location data will appear here</div>
        </div>
        <div class="form-group">
            <label>Video & Audio:</label>
            <button id="request_media_btn">Request Media</button>
            <div id="media_data" class="placeholder">Media stream info will appear here</div>
        </div>
        <div class="form-group">
            <label>Contact:</label>
            <button id="request_contact_btn">Request Contact</button>
            <div id="contact_data" class="placeholder">Contact data will appear here</div>
        </div>
        <div class="form-group">
            <label>Write access:</label>
            <button id="request_write_access_btn">Request Write Access</button>
            <div id="write_access_status" class="placeholder">Write access status will appear here</div>
        </div>
        <div class="form-group">
            <label>Server Time:</label>
            <button id="request_server_time_btn">Request Server Time</button>
            <div id="server_time_data" class="placeholder">Server time will appear here</div>
        </div>

        <div class="section-header">Sensors</div>
        <div class="form-group">
            <label>Accelerometer:</label>
            <button id="accelerometer_btn">Start Accelerometer</button>
            <div id="accelerometer_data" class="placeholder">Accelerometer data will appear here</div>
        </div>
        <div class="form-group">
            <label>Device Orientation:</label>
            <button id="device_orientation_btn">Start Device Orientation</button>
            <div id="device_orientation_data" class="placeholder">Device orientation data will appear here</div>
        </div>
        <div class="form-group">
            <label>Gyroscope:</label>
            <button id="gyroscope_btn">Start Gyroscope</button>
            <div id="gyroscope_data" class="placeholder">Gyroscope data will appear here</div>
        </div>

        <div class="section-header">Alerts & Popups</div>
        <button id="alert_btn">Show Alert (Native)</button>
        <button id="confirm_btn">Show Confirm (Native)</button>
        <button id="prompt_btn">Show Prompt (Native)</button>
        <button id="tg_alert_btn">Show Alert (Telegram)</button>
        <button id="tg_confirm_btn">Show Confirm (Telegram)</button>
        <button id="tg_popup_btn">Show Popup (Telegram)</button>

        <div class="section-header">Haptic Feedback</div>
        <button id="impact_feedback_btn">Impact Feedback</button>
        <button id="notification_feedback_btn">Notification Feedback</button>
        <button id="selection_feedback_btn">Selection Feedback</button>

        <div class="section-header">Sending Messages</div>
        <button id="send_text_btn">Send «Hello, World!»</button>
        <button id="send_inline_webview_btn">Send «Hello, World!» with inline webview button</button>
        <button id="share_text_btn">Share «Hello, World!»</button>

        <div class="section-header">Links</div>
        <div class="form-group">
            <label for="link_input">Link to open:</label>
            <input type="text" id="link_input" value="https://example.com">
        </div>
        <button id="open_link_btn">Open Link (outside webview)</button>
        <button id="open_tg_link_btn">Open Telegram Link</button>
        <button id="open_tg_app_link_btn">Open Telegram App Link</button>
        <button id="open_link_target_blank_btn">Open Link (target="_blank")</button>
        <button id="open_link_window_open_btn">Open Link (window.open)</button>
        <button id="open_link_instant_view_btn">Open Link (instant view)</button>

        <div class="section-header">Browser-Specific Links</div>
        <button id="open_chrome_link_btn">Open in Chrome</button>
        <button id="open_firefox_link_btn">Open in Firefox</button>
        <button id="open_safari_link_btn">Open in Safari</button>
        <button id="open_opera_link_btn">Open in Opera</button>

        <div class="section-header">Story Sharing</div>
        <button id="share_picture_btn">Share Picture to Story</button>
        <button id="share_video_btn">Share Video to Story</button>
        <button id="share_video_link_btn">Share Video Link to Story</button>

        <div class="section-header">File Downloads</div>
        <button id="download_picture_btn">Download Picture</button>
        <button id="download_video_btn">Download Video</button>
        <button id="download_pdf_btn">Download PDF</button>

        <div class="section-header">Stickerpacks</div>
        <button id="add_stickerpack_btn">Add Stickerpack</button>

        <div class="section-header">Home Screen</div>
        <button id="check_home_screen_btn">Check Home Screen Status</button>
        <button id="add_home_screen_btn">Add to Home Screen</button>
        <div id="home_screen_status"></div>

        <div class="section-header">Emoji Status</div>
        <div class="form-group">
            <label for="emoji_status_input">Emoji Status (e.g., 👍, 🤔):</label>
            <input type="text" id="emoji_status_input" value="🤔">
            <label for="emoji_status_duration">Duration (seconds, 0 for infinite):</label>
            <input type="number" id="emoji_status_duration" value="0">
            <button id="set_emoji_status_btn">Set Emoji Status</button>
        </div>
        <button id="request_emoji_status_access_btn">Request Emoji Status Access</button>

        <div class="section-header">Misc</div>
        <div class="form-group">
            <label for="input_field_1">Regular Input:</label>
            <input type="text" id="input_field_1" placeholder="Type something...">
        </div>
        <div class="form-group">
            <label>Content Editable:</label>
            <div contenteditable="true" data-placeholder="Type something here..." style="border: 1px solid #ccc; padding: 8px; min-height: 50px;"></div>
        </div>

        <div class="bottom-bar-widget" id="bottom_bar_widget"></div>
    </div>

    <script>
        const DemoApp = {};

        // Helper function to display data
        function displayData(id, data) {
            const element = document.getElementById(id);
            if (element) {
                element.innerText = JSON.stringify(data, null, 2);
            }
        }

        // --- Core Web App Info ---
        displayData('init_data_unsafe', Telegram.WebApp.initDataUnsafe); // Full initDataUnsafe

        // Display individual parts of initDataUnsafe and user
        const initData = Telegram.WebApp.initDataUnsafe;
        document.getElementById('query_id_display').innerText = initData.query_id || 'N/A';
        document.getElementById('auth_date_display').innerText = initData.auth_date ? new Date(initData.auth_date * 1000).toLocaleString() : 'N/A';
        document.getElementById('signature_display').innerText = initData.signature || 'N/A';
        document.getElementById('hash_display').innerText = initData.hash || 'N/A';

        if (initData.user) {
            const user = initData.user;
            document.getElementById('user_id').innerText = user.id || 'N/A';
            document.getElementById('user_first_name').innerText = user.first_name || 'N/A';
            document.getElementById('user_last_name').innerText = user.last_name || 'N/A';
            document.getElementById('user_username').innerText = user.username ? `@${user.username}` : 'N/A';
            document.getElementById('user_language_code').innerText = user.language_code || 'N/A';
            document.getElementById('user_allows_write_to_pm').innerText = user.allows_write_to_pm ? 'Yes' : 'No';
            document.getElementById('user_photo_url').innerText = user.photo_url || 'N/A';
            document.getElementById('user_is_premium').innerText = user.is_premium ? 'Yes' : 'No';
            document.getElementById('user_added_to_attachment_menu').innerText = user.added_to_attachment_menu ? 'Yes' : 'No';
        } else {
            // If user object is not present in initDataUnsafe (e.g., in a channel post context)
            document.getElementById('user_id').innerText = 'Not available';
            document.getElementById('user_first_name').innerText = 'Not available';
            document.getElementById('user_last_name').innerText = 'Not available';
            document.getElementById('user_username').innerText = 'Not available';
            document.getElementById('user_language_code').innerText = 'Not available';
            document.getElementById('user_allows_write_to_pm').innerText = 'Not available';
            document.getElementById('user_photo_url').innerText = 'Not available';
            document.getElementById('user_is_premium').innerText = 'Not available';
            document.getElementById('user_added_to_attachment_menu').innerText = 'Not available';
        }


        displayData('theme_params', Telegram.WebApp.themeParams);
        displayData('web_app_version', Telegram.WebApp.version);
        displayData('web_app_platform', Telegram.WebApp.platform);
        displayData('is_expanded', Telegram.WebApp.isExpanded);
        displayData('viewport_height', Telegram.WebApp.viewportHeight);
        displayData('viewport_stable_height', Telegram.WebApp.viewportStableHeight);
        displayData('closing_confirmation', Telegram.WebApp.isClosingConfirmationEnabled);
        displayData('is_inited', Telegram.WebApp.isInited);

        // --- Header and Bottom Bar Colors ---
        const headerWidget = document.getElementById('header_widget');
        const bottomBarWidget = document.getElementById('bottom_bar_widget');
        const headerColorInput = document.getElementById('header_color_input');
        const headerColorPicker = document.getElementById('header_color_picker');
        const bbarColorInput = document.getElementById('bottom_bar_color_input');
        const bbarColorPicker = document.getElementById('bottom_bar_color_picker');
        const bgColorInput = document.getElementById('bg_color_input');

        function updateColors() {
            headerWidget.style.backgroundColor = Telegram.WebApp.headerColor;
            headerColorInput.value = Telegram.WebApp.headerColor;
            headerColorPicker.value = Telegram.WebApp.headerColor;

            bottomBarWidget.style.backgroundColor = Telegram.WebApp.bottomBarColor;
            bbarColorInput.value = Telegram.WebApp.bottomBarColor;
            bbarColorPicker.value = Telegram.WebApp.bottomBarColor;

            bgColorInput.value = Telegram.WebApp.backgroundColor;
            document.body.style.setProperty('--bg-color', Telegram.WebApp.backgroundColor);
        }

        Telegram.WebApp.onEvent('themeChanged', updateColors);
        Telegram.WebApp.onEvent('viewportChanged', function() {
            displayData('viewport_height', Telegram.WebApp.viewportHeight);
            displayData('viewport_stable_height', Telegram.WebApp.viewportStableHeight);
        });
        updateColors();

        let prevHeaderColorValue = headerColorInput.value;
        headerColorPicker.addEventListener('input', function() {
            headerColorInput.value = headerColorPicker.value;
            Telegram.WebApp.setHeaderColor(headerColorPicker.value);
        });
        headerColorInput.addEventListener('change', function() {
            if (/^#[0-9A-F]{6}$/i.test(headerColorInput.value)) {
                Telegram.WebApp.setHeaderColor(headerColorInput.value);
                headerColorPicker.value = headerColorInput.value;
            } else {
                headerColorInput.value = prevHeaderColorValue;
            }
        });

        let prevBbarColorValue = bbarColorInput.value;
        bbarColorPicker.addEventListener('input', function() {
            bbarColorInput.value = bbarColorPicker.value;
            Telegram.WebApp.setBottomBarColor(bbarColorPicker.value);
        });
        bbarColorInput.addEventListener('change', function() {
            if (/^#[0-9A-F]{6}$/i.test(bbarColorInput.value)) {
                Telegram.WebApp.setBottomBarColor(bbarColorInput.value);
                bbarColorPicker.value = bbarColorInput.value;
            } else {
                bbarColorInput.value = prevBbarColorValue;
            }
        });

        // --- Main Button ---
        const mainButtonTextInput = document.getElementById('main_button_text_input');
        const setMainButtonTextBtn = document.getElementById('set_main_button_text');
        const mainButtonVisibleSpan = document.getElementById('main_button_visible');
        const showMainButtonBtn = document.getElementById('show_main_button');
        const hideMainButtonBtn = document.getElementById('hide_main_button');

        Telegram.WebApp.MainButton.setText("Close Webview");
        Telegram.WebApp.MainButton.show();
        Telegram.WebApp.MainButton.onClick(function() {
            Telegram.WebApp.close();
        });
        mainButtonVisibleSpan.innerText = Telegram.WebApp.MainButton.isVisible;

        setMainButtonTextBtn.addEventListener('click', function() {
            Telegram.WebApp.MainButton.setText(mainButtonTextInput.value);
        });
        showMainButtonBtn.addEventListener('click', function() {
            Telegram.WebApp.MainButton.show();
            mainButtonVisibleSpan.innerText = Telegram.WebApp.MainButton.isVisible;
        });
        hideMainButtonBtn.addEventListener('click', function() {
            Telegram.WebApp.MainButton.hide();
            mainButtonVisibleSpan.innerText = Telegram.WebApp.MainButton.isVisible;
        });

        // --- Secondary Button ---
        const secondaryButtonVisibleSpan = document.getElementById('secondary_button_visible');
        const showSecondaryButtonBtn = document.getElementById('show_secondary_button');
        const hideSecondaryButtonBtn = document.getElementById('hide_secondary_button');

        Telegram.WebApp.SecondaryButton.setText("Do Something");
        Telegram.WebApp.SecondaryButton.show();
        Telegram.WebApp.SecondaryButton.onClick(function() {
            Telegram.WebApp.showAlert("Secondary button clicked!");
        });
        secondaryButtonVisibleSpan.innerText = Telegram.WebApp.SecondaryButton.isVisible;

        showSecondaryButtonBtn.addEventListener('click', function() {
            Telegram.WebApp.SecondaryButton.show();
            secondaryButtonVisibleSpan.innerText = Telegram.WebApp.SecondaryButton.isVisible;
        });
        hideSecondaryButtonBtn.addEventListener('click', function() {
            Telegram.WebApp.SecondaryButton.hide();
            secondaryButtonVisibleSpan.innerText = Telegram.WebApp.SecondaryButton.isVisible;
        });

        // --- Back Button ---
        const backButtonVisibleSpan = document.getElementById('back_button_visible');
        const showBackButtonBtn = document.getElementById('show_back_button');

        Telegram.WebApp.onEvent('backButtonClicked', function() {
            Telegram.WebApp.showAlert("Back button clicked!");
        });
        backButtonVisibleSpan.innerText = Telegram.WebApp.BackButton.isVisible;

        showBackButtonBtn.addEventListener('click', function() {
            Telegram.WebApp.BackButton.show();
            backButtonVisibleSpan.innerText = Telegram.WebApp.BackButton.isVisible;
        });

        // --- Settings Button ---
        const settingsButtonVisibleSpan = document.getElementById('settings_button_visible');
        const showSettingsButtonBtn = document.getElementById('show_settings_button');

        Telegram.WebApp.onEvent('settingsButtonClicked', function() {
            Telegram.WebApp.showAlert("Settings button clicked!");
        });
        settingsButtonVisibleSpan.innerText = Telegram.WebApp.SettingsButton.isVisible;

        showSettingsButtonBtn.addEventListener('click', function() {
            Telegram.WebApp.SettingsButton.show();
            settingsButtonVisibleSpan.innerText = Telegram.WebApp.SettingsButton.isVisible;
        });

        // --- Actions ---
        document.getElementById('close_webview_btn').addEventListener('click', function() {
            Telegram.WebApp.close();
        });
        document.getElementById('expand_webview_btn').addEventListener('click', function() {
            Telegram.WebApp.expand();
        });
        document.getElementById('request_fullscreen_btn').addEventListener('click', function() {
            Telegram.WebApp.requestFullsize();
        });

        const showProgressBtn = document.getElementById('show_progress_btn');
        const hideProgressBtn = document.getElementById('hide_progress_btn');
        showProgressBtn.addEventListener('click', function() {
            Telegram.WebApp.showProgress(true);
        });
        hideProgressBtn.addEventListener('click', function() {
            Telegram.WebApp.hideProgress();
        });

        const closingConfirmationSpan = document.getElementById('closing_confirmation');
        const setClosingConfirmationBtn = document.getElementById('set_closing_confirmation_btn');
        const unsetClosingConfirmationBtn = document.getElementById('unset_closing_confirmation_btn');
        closingConfirmationSpan.innerText = Telegram.WebApp.isClosingConfirmationEnabled;
        setClosingConfirmationBtn.addEventListener('click', function() {
            Telegram.WebApp.enableClosingConfirmation();
            closingConfirmationSpan.innerText = Telegram.WebApp.isClosingConfirmationEnabled;
        });
        unsetClosingConfirmationBtn.addEventListener('click', function() {
            Telegram.WebApp.disableClosingConfirmation();
            closingConfirmationSpan.innerText = Telegram.WebApp.isClosingConfirmationEnabled;
        });

        // --- Orientation ---
        const orientBtn = document.getElementById('orient_btn');
        const isOrientationLockedSpan = document.getElementById('is_orientation_locked');

        function updateOrientationStatus() {
            isOrientationLockedSpan.innerText = Telegram.WebApp.isOrientationLocked;
            if (Telegram.WebApp.isOrientationLocked) {
                orientBtn.innerHTML = 'Unlock Orientation';
            } else {
                orientBtn.innerHTML = 'Lock Orientation';
            }
        }
        updateOrientationStatus();

        orientBtn.addEventListener('click', function() {
            if (Telegram.WebApp.isOrientationLocked) {
                Telegram.WebApp.unlockOrientation();
            } else {
                Telegram.WebApp.lockOrientation('landscape'); // Or 'portrait'
            }
            updateOrientationStatus();
        });

        // --- Vertical Swipes ---
        const verticalSwipesEnabledSpan = document.getElementById('vertical_swipes_enabled');
        const disableVerticalSwipesBtn = document.getElementById('disable_vertical_swipes_btn');
        verticalSwipesEnabledSpan.innerText = Telegram.WebApp.isVerticalSwipesEnabled;

        disableVerticalSwipesBtn.addEventListener('click', function() {
            Telegram.WebApp.disableVerticalSwipes();
            verticalSwipesEnabledSpan.innerText = Telegram.WebApp.isVerticalSwipesEnabled;
        });

        // --- Scan QR Popup ---
        document.getElementById('scan_qr_btn').addEventListener('click', function() {
            Telegram.WebApp.showScanQrPopup({ text: "Scan QR code..." }, function(text) {
                Telegram.WebApp.showAlert("Scanned: " + text);
                return true; // Close the popup
            });
        });

        // --- Custom Styles ---
        document.getElementById('set_custom_styles').addEventListener('click', function() {
            Telegram.WebApp.setCustomStyle({
                "--tg-theme-button-color": "red",
                "--tg-theme-button-text-color": "yellow",
                "--tg-theme-bg-color": "blue"
            });
        });
        document.getElementById('remove_custom_styles').addEventListener('click', function() {
            Telegram.WebApp.setCustomStyle({}); // Remove custom styles
        });

        // --- Activity ---
        const activityDurationSpan = document.getElementById('activity_duration');
        const activityPreviousDurationSpan = document.getElementById('activity_previous_duration');

        function updateActivityDuration() {
            activityDurationSpan.innerText = 'Current activity: ' + Telegram.WebApp.activity.duration + 'ms';
            activityPreviousDurationSpan.innerText = 'Previous activity: ' + Telegram.WebApp.activity.previousDuration + 'ms';
        }
        Telegram.WebApp.onEvent('activityChanged', updateActivityDuration);
        updateActivityDuration();


        // --- Clipboard ---
        DemoApp.testClipboard = function(element) {
            if (Telegram.WebApp.isClipboardAvailable) {
                element.innerText = 'Clipboard available.';
                element.style.color = 'green';
            } else {
                element.innerText = 'Clipboard NOT available.';
                element.style.color = 'red';
            }
        };

        document.getElementById('write_clipboard_btn').addEventListener('click', function() {
            const text = document.getElementById('clipboard_text_input').value;
            Telegram.WebApp.writeClipboardText(text);
            Telegram.WebApp.showAlert('Text copied to clipboard!');
        });

        document.getElementById('read_clipboard_btn').addEventListener('click', function() {
            Telegram.WebApp.readClipboardText(function(text) {
                if (text) {
                    Telegram.WebApp.showAlert('Read from clipboard: ' + text);
                } else {
                    Telegram.WebApp.showAlert('No text found in clipboard or access denied.');
                }
            });
        });

        // --- Cloud Storage ---
        DemoApp.loadCloudKeys = function() {
            const statusDiv = document.getElementById('cloud_storage_status');
            const tableBody = document.getElementById('cloud_storage_table').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '<tr><td colspan="3">Loading...</td></tr>';
            statusDiv.innerText = 'Loading cloud keys...';

            Telegram.WebApp.CloudStorage.getKeys(function(keys) {
                if (!keys || keys.length === 0) {
                    statusDiv.innerText = 'No keys found in Cloud Storage.';
                    tableBody.innerHTML = '<tr><td colspan="3">No keys found.</td></tr>';
                    return;
                }
                statusDiv.innerText = 'Keys loaded: ' + keys.join(', ');

                Telegram.WebApp.CloudStorage.getItems(keys, function(items) {
                    tableBody.innerHTML = '';
                    for (const key in items) {
                        const row = tableBody.insertRow();
                        row.insertCell().innerText = key;
                        row.insertCell().innerText = items[key];
                        const actionsCell = row.insertCell();

                        const editBtn = document.createElement('button');
                        editBtn.innerText = 'Edit';
                        editBtn.className = 'outline';
                        editBtn.addEventListener('click', function() {
                            document.getElementById('cloud_storage_key').value = key;
                            document.getElementById('cloud_storage_value').value = items[key];
                        });
                        actionsCell.appendChild(editBtn);

                        const deleteBtn = document.createElement('button');
                        deleteBtn.innerText = 'Delete';
                        deleteBtn.className = 'destructive outline';
                        deleteBtn.addEventListener('click', function() {
                            Telegram.WebApp.CloudStorage.deleteItems([key], function(success) {
                                if (success) {
                                    Telegram.WebApp.showAlert('Key "' + key + '" deleted.');
                                    DemoApp.loadCloudKeys();
                                } else {
                                    Telegram.WebApp.showAlert('Failed to delete key "' + key + '".');
                                }
                            });
                        });
                        actionsCell.appendChild(deleteBtn);
                    }
                });
            });
        };

        document.getElementById('cloud_storage_save_btn').addEventListener('click', function() {
            const key = document.getElementById('cloud_storage_key').value;
            const value = document.getElementById('cloud_storage_value').value;
            if (!key || !value) {
                Telegram.WebApp.showAlert('Key and Value cannot be empty!');
                return;
            }
            Telegram.WebApp.CloudStorage.setItems({ [key]: value }, function(success) {
                if (success) {
                    Telegram.WebApp.showAlert('Saved "' + key + ': ' + value + '" to Cloud Storage.');
                    document.getElementById('cloud_storage_key').value = '';
                    document.getElementById('cloud_storage_value').value = '';
                    DemoApp.loadCloudKeys();
                } else {
                    Telegram.WebApp.showAlert('Failed to save to Cloud Storage.');
                }
            });
        });

        document.getElementById('cloud_storage_delete_all_btn').addEventListener('click', function() {
            Telegram.WebApp.showConfirm('Are you sure you want to delete all cloud storage items?', function(ok) {
                if (ok) {
                    Telegram.WebApp.CloudStorage.getKeys(function(keys) {
                        if (keys && keys.length > 0) {
                            Telegram.WebApp.CloudStorage.deleteItems(keys, function(success) {
                                if (success) {
                                    Telegram.WebApp.showAlert('All items deleted from Cloud Storage.');
                                    DemoApp.loadCloudKeys();
                                } else {
                                    Telegram.WebApp.showAlert('Failed to delete all items from Cloud Storage.');
                                }
                            });
                        } else {
                            Telegram.WebApp.showAlert('No items to delete.');
                        }
                    });
                }
            });
        });

        document.getElementById('cloud_storage_get_all_btn').addEventListener('click', DemoApp.loadCloudKeys);


        // --- Biometrics ---
        DemoApp.biometricInit = function() {
            const statusDiv = document.getElementById('biometric_status');
            const bio = Telegram.WebApp.BiometricManager;

            function updateBiometricStatus() {
                let html = '';
                if (bio.isInited) {
                    html += '<div class="biometric-status-item"><strong>Inited:</strong> Yes</div>';
                    html += '<div class="biometric-status-item"><strong>Available:</strong> ' + (bio.isAvailable ? 'Yes' : 'No') + '</div>';
                    html += '<div class="biometric-status-item"><strong>Type:</strong> ' + (bio.biometricType || 'N/A') + '</div>';
                    html += '<div class="biometric-status-item"><strong>Access Requested:</strong> ' + (bio.isAccessRequested ? 'Yes' : 'No') + '</div>';
                    html += '<div class="biometric-status-item"><strong>Access Granted:</strong> ' + (bio.isAccessGranted ? 'Yes' : 'No') + '</div>';
                    html += '<div class="biometric-status-item"><strong>Token Saved:</strong> ' + (bio.isBiometricTokenSaved ? 'Yes' : 'No') + '</div>';
                    html += '<div class="biometric-status-item"><strong>Device ID:</strong> ' + (bio.deviceId || 'N/A') + '</div>';
                } else {
                    html = 'Biometric Manager not inited.';
                }
                statusDiv.innerHTML = html;

                document.getElementById('biometric_request_access_btn').disabled = !bio.isAvailable || bio.isAccessRequested;
                document.getElementById('biometric_authenticate_btn').disabled = !bio.isAccessGranted;
                document.getElementById('biometric_open_settings_btn').disabled = !bio.isAvailable;
                document.getElementById('biometric_set_token_btn').disabled = !bio.isAccessGranted;
                document.getElementById('biometric_delete_token_btn').disabled = !bio.isBiometricTokenSaved;
            }

            Telegram.WebApp.onEvent('biometricAuthRequested', updateBiometricStatus);
            Telegram.WebApp.onEvent('biometricAuthGranted', updateBiometricStatus);
            Telegram.WebApp.onEvent('biometricAuthRevoked', updateBiometricStatus);
            Telegram.WebApp.onEvent('biometricTokenSaved', updateBiometricStatus);
            Telegram.WebApp.onEvent('biometricTokenDeleted', updateBiometricStatus);

            updateBiometricStatus();

            document.getElementById('biometric_request_access_btn').addEventListener('click', function() {
                bio.requestAccess(function(success) {
                    Telegram.WebApp.showAlert('Biometric access ' + (success ? 'granted' : 'denied') + '!');
                    updateBiometricStatus();
                });
            });

            document.getElementById('biometric_authenticate_btn').addEventListener('click', function() {
                bio.authenticate(function(success, token) {
                    if (success) {
                        Telegram.WebApp.showAlert('Authentication successful! Token: ' + (token || 'None'));
                    } else {
                        Telegram.WebApp.showAlert('Authentication failed!');
                    }
                    updateBiometricStatus();
                });
            });

            document.getElementById('biometric_open_settings_btn').addEventListener('click', function() {
                bio.openSettings();
            });

            document.getElementById('biometric_set_token_btn').addEventListener('click', function() {
                const token = prompt('Enter a token to save:');
                if (token !== null) {
                    bio.setBiometricToken(token, function(success) {
                        Telegram.WebApp.showAlert('Token ' + (success ? 'saved' : 'failed to save') + '!');
                        updateBiometricStatus();
                    });
                }
            });

            document.getElementById('biometric_delete_token_btn').addEventListener('click', function() {
                bio.authenticate(function(success) {
                    if (success) {
                        bio.deleteBiometricToken(function(deleted) {
                            Telegram.WebApp.showAlert('Token ' + (deleted ? 'deleted' : 'failed to delete') + '!');
                            updateBiometricStatus();
                        });
                    } else {
                        Telegram.WebApp.showAlert('Authentication required to delete token failed.');
                    }
                });
            });
        };

        // --- Permissions ---
        DemoApp.locationInit = function() {
            const locationData = document.getElementById('location_data');
            const requestLocationBtn = document.getElementById('request_location_btn');

            requestLocationBtn.addEventListener('click', function() {
                if (Telegram.WebApp.LocationManager.isAvailable) {
                    Telegram.WebApp.LocationManager.requestLocation(function(coords) {
                        if (coords) {
                            locationData.innerHTML = `Latitude: ${coords.latitude}<br>Longitude: ${coords.longitude}`;
                            locationData.style.color = 'green';
                        } else {
                            locationData.innerText = 'Location access denied or failed.';
                            locationData.style.color = 'red';
                        }
                    });
                } else {
                    locationData.innerText = 'Location Manager not available.';
                    locationData.style.color = 'red';
                }
            });
        };

        document.getElementById('request_media_btn').addEventListener('click', function() {
            const mediaData = document.getElementById('media_data');
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                    .then(function(stream) {
                        mediaData.innerText = 'Media access granted! Stream active.';
                        mediaData.style.color = 'green';
                        // You might want to stop the stream after a bit
                        setTimeout(() => {
                            stream.getTracks().forEach(track => track.stop());
                            mediaData.innerText += '\nStream stopped after 5 seconds.';
                        }, 5000);
                    })
                    .catch(function(err) {
                        mediaData.innerText = `Media access denied or error: ${err.message}`;
                        mediaData.style.color = 'red';
                    });
            } else {
                mediaData.innerText = 'getUserMedia not supported in this browser.';
                mediaData.style.color = 'red';
            }
        });

        document.getElementById('request_contact_btn').addEventListener('click', function() {
            const contactData = document.getElementById('contact_data');
            Telegram.WebApp.requestContact(function(success) {
                if (success) {
                    contactData.innerText = 'Contact shared!';
                    contactData.style.color = 'green';
                    // The actual contact data is not directly exposed for privacy reasons.
                    // This merely confirms the user shared their contact.
                } else {
                    contactData.innerText = 'Contact sharing denied.';
                    contactData.style.color = 'red';
                }
            });
        });

        const writeAccessStatus = document.getElementById('write_access_status');
        document.getElementById('request_write_access_btn').addEventListener('click', function() {
            Telegram.WebApp.requestWriteAccess(function(success) {
                if (success) {
                    writeAccessStatus.innerText = 'Write access granted!';
                    writeAccessStatus.style.color = 'green';
                } else {
                    writeAccessStatus.innerText = 'Write access denied.';
                    writeAccessStatus.style.color = 'red';
                }
            });
        });

        document.getElementById('request_server_time_btn').addEventListener('click', function() {
            const serverTimeData = document.getElementById('server_time_data');
            Telegram.WebApp.invokeCustomMethod('getServerTime', {}, function(err, result) {
                if (err) {
                    serverTimeData.innerText = 'Error getting server time: ' + err.message;
                    serverTimeData.style.color = 'red';
                } else {
                    serverTimeData.innerText = 'Server Time: ' + new Date(result.timestamp * 1000).toLocaleString();
                    serverTimeData.style.color = 'green';
                }
            });
        });

        // --- Sensors ---
        DemoApp.accelerometerInit = function() {
            const accelerometerBtn = document.getElementById('accelerometer_btn');
            const accelerometerData = document.getElementById('accelerometer_data');
            let isReading = false;
            let accelerometer;

            accelerometerBtn.addEventListener('click', function() {
                if (!isReading) {
                    if ('Accelerometer' in window) {
                        accelerometer = new Accelerometer({ frequency: 60 });
                        accelerometer.addEventListener('reading', function(e) {
                            accelerometerData.innerText = `X: ${accelerometer.x?.toFixed(2)}, Y: ${accelerometer.y?.toFixed(2)}, Z: ${accelerometer.z?.toFixed(2)}`;
                        });
                        accelerometer.addEventListener('error', function(e) {
                            accelerometerData.innerText = `Accelerometer error: ${e.message}`;
                            accelerometerData.style.color = 'red';
                            isReading = false;
                            accelerometerBtn.innerText = 'Start Accelerometer';
                        });
                        accelerometer.start();
                        accelerometerData.style.color = 'black';
                        accelerometerBtn.innerText = 'Stop Accelerometer';
                        isReading = true;
                    } else {
                        accelerometerData.innerText = 'Accelerometer API not supported.';
                        accelerometerData.style.color = 'red';
                    }
                } else {
                    if (accelerometer) {
                        accelerometer.stop();
                        accelerometer = null;
                        accelerometerData.innerText = 'Accelerometer stopped.';
                        accelerometerData.style.color = 'black';
                    }
                    accelerometerBtn.innerText = 'Start Accelerometer';
                    isReading = false;
                }
            });
        };

        DemoApp.deviceOrientationInit = function() {
            const deviceOrientationBtn = document.getElementById('device_orientation_btn');
            const deviceOrientationData = document.getElementById('device_orientation_data');
            let isReading = false;
            let handleOrientation = null; // Declare outside to allow proper removal

            deviceOrientationBtn.addEventListener('click', function() {
                if (!isReading) {
                    if ('DeviceOrientationEvent' in window) {
                        handleOrientation = function(event) {
                            deviceOrientationData.innerText = `Alpha: ${event.alpha?.toFixed(2)}, Beta: ${event.beta?.toFixed(2)}, Gamma: ${event.gamma?.toFixed(2)}`;
                            if (event.absolute !== undefined) {
                                deviceOrientationData.innerText += `\nAbsolute: ${event.absolute ? 'Yes' : 'No'}`;
                            }
                        };
                        window.addEventListener('deviceorientation', handleOrientation);
                        deviceOrientationData.style.color = 'black';
                        deviceOrientationBtn.innerText = 'Stop Device Orientation';
                        isReading = true;
                    } else {
                        deviceOrientationData.innerText = 'Device Orientation API not supported.';
                        deviceOrientationData.style.color = 'red';
                    }
                } else {
                    if (handleOrientation) { // Check if the handler was set
                        window.removeEventListener('deviceorientation', handleOrientation);
                    }
                    deviceOrientationData.innerText = 'Device Orientation stopped.';
                    deviceOrientationData.style.color = 'black';
                    deviceOrientationBtn.innerText = 'Start Device Orientation';
                    isReading = false;
                }
            });
        };

        DemoApp.gyroscopeInit = function() {
            const gyroscopeBtn = document.getElementById('gyroscope_btn');
            const gyroscopeData = document.getElementById('gyroscope_data');
            let isReading = false;
            let gyroscope;

            gyroscopeBtn.addEventListener('click', function() {
                if (!isReading) {
                    if ('Gyroscope' in window) {
                        gyroscope = new Gyroscope({ frequency: 60 });
                        gyroscope.addEventListener('reading', function(e) {
                            gyroscopeData.innerText = `X: ${gyroscope.x?.toFixed(2)}, Y: ${gyroscope.y?.toFixed(2)}, Z: ${gyroscope.z?.toFixed(2)}`;
                        });
                        gyroscope.addEventListener('error', function(e) {
                            gyroscopeData.innerText = `Gyroscope error: ${e.message}`;
                            gyroscopeData.style.color = 'red';
                            isReading = false;
                            gyroscopeBtn.innerText = 'Start Gyroscope';
                        });
                        gyroscope.start();
                        gyroscopeData.style.color = 'black';
                        gyroscopeBtn.innerText = 'Stop Gyroscope';
                        isReading = true;
                    } else {
                        gyroscopeData.innerText = 'Gyroscope API not supported.';
                        gyroscopeData.style.color = 'red';
                    }
                } else {
                    if (gyroscope) {
                        gyroscope.stop();
                        gyroscope = null;
                        gyroscopeData.innerText = 'Gyroscope stopped.';
                        gyroscopeData.style.color = 'black';
                    }
                    gyroscopeBtn.innerText = 'Start Gyroscope';
                    isReading = false;
                }
            });
        };

        // --- Alerts & Popups ---
        document.getElementById('alert_btn').addEventListener('click', function() {
            alert('This is a native browser alert!');
        });
        document.getElementById('confirm_btn').addEventListener('click', function() {
            const result = confirm('This is a native browser confirm. Continue?');
            alert('Confirmed: ' + result);
        });
        document.getElementById('prompt_btn').addEventListener('click', function() {
            const result = prompt('This is a native browser prompt. Enter your name:', 'Guest');
            alert('Entered: ' + result);
        });

        document.getElementById('tg_alert_btn').addEventListener('click', function() {
            Telegram.WebApp.showAlert('This is a Telegram Web App alert!');
        });
        document.getElementById('tg_confirm_btn').addEventListener('click', function() {
            Telegram.WebApp.showConfirm('This is a Telegram Web App confirm. Continue?', function(ok) {
                Telegram.WebApp.showAlert('Confirmed: ' + ok);
            });
        });
        document.getElementById('tg_popup_btn').addEventListener('click', function() {
            Telegram.WebApp.showPopup({
                title: 'Telegram Popup',
                message: 'This is a custom Telegram Web App popup.',
                buttons: [
                    { id: 'ok', type: 'default', text: 'OK' },
                    { id: 'cancel', type: 'cancel', text: 'Cancel' },
                    { id: 'destructive', type: 'destructive', text: 'Delete' }
                ]
            }, function(buttonId) {
                Telegram.WebApp.showAlert('Button clicked: ' + buttonId);
            });
        });

        // --- Haptic Feedback ---
        document.getElementById('impact_feedback_btn').addEventListener('click', function() {
            Telegram.WebApp.HapticFeedback.impactOccurred('medium'); // 'light', 'medium', 'heavy', 'rigid', 'soft'
        });
        document.getElementById('notification_feedback_btn').addEventListener('click', function() {
            Telegram.WebApp.HapticFeedback.notificationOccurred('success'); // 'success', 'warning', 'error'
        });
        document.getElementById('selection_feedback_btn').addEventListener('click', function() {
            Telegram.WebApp.HapticFeedback.selectionChanged();
        });

        // --- Sending Messages ---
        document.getElementById('send_text_btn').addEventListener('click', function() {
            Telegram.WebApp.sendData('Hello, World!');
        });
        document.getElementById('send_inline_webview_btn').addEventListener('click', function() {
            Telegram.WebApp.sendData(JSON.stringify({
                text: 'Hello, World!',
                reply_markup: {
                    inline_keyboard: [
                        [{ text: 'Open Webview', web_app: { url: window.location.href } }]
                    ]
                }
            }));
        });
        document.getElementById('share_text_btn').addEventListener('click', function() {
            Telegram.WebApp.shareText('Sharing "Hello, World!" from Web App!');
        });

        // --- Links ---
        const linkInput = document.getElementById('link_input');
        document.getElementById('open_link_btn').addEventListener('click', function() {
            Telegram.WebApp.openLink(linkInput.value);
        });
        document.getElementById('open_tg_link_btn').addEventListener('click', function() {
            // Example: https://t.me/telegram
            Telegram.WebApp.openTelegramLink(linkInput.value);
        });
        document.getElementById('open_tg_app_link_btn').addEventListener('click', function() {
            // Example: tg://resolve?domain=telegram
            Telegram.WebApp.openTelegramApp(linkInput.value);
        });
        document.getElementById('open_link_target_blank_btn').addEventListener('click', function() {
            const a = document.createElement('a');
            a.href = linkInput.value;
            a.target = '_blank';
            a.click();
        });
        document.getElementById('open_link_window_open_btn').addEventListener('click', function() {
            window.open(linkInput.value);
        });
        document.getElementById('open_link_instant_view_btn').addEventListener('click', function() {
            // Requires a link that supports instant view, e.g., some medium.com articles
            Telegram.WebApp.openLink(linkInput.value, { try_instant_view: true });
        });

        // --- Browser-Specific Links (for demonstration, might not open directly) ---
        document.getElementById('open_chrome_link_btn').addEventListener('click', function() {
            window.open('googlechrome://navigate?url=https://www.google.com');
        });
        document.getElementById('open_firefox_link_btn').addEventListener('click', function() {
            window.open('firefox://openurl?url=https://www.mozilla.org');
        });
        document.getElementById('open_safari_link_btn').addEventListener('click', function() {
            window.open('safari-http://www.apple.com');
        });
        document.getElementById('open_opera_link_btn').addEventListener('click', function() {
            window.open('opera://openurl?url=https://www.opera.com');
        });

        // --- Story Sharing ---
        document.getElementById('share_picture_btn').addEventListener('click', function() {
            Telegram.WebApp.shareToStory('photo', {
                url: 'https://picsum.photos/600/800', // Replace with your image URL
                caption: 'My awesome picture from Web App!',
                link: {
                    url: 'https://example.com/mypicture',
                    text: 'View More'
                }
            });
        });

        document.getElementById('share_video_btn').addEventListener('click', function() {
            Telegram.WebApp.shareToStory('video', {
                url: 'http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4', // Replace with your video URL
                caption: 'My cool video from Web App!'
            });
        });

        document.getElementById('share_video_link_btn').addEventListener('click', function() {
            Telegram.WebApp.shareToStory('video', {
                url: 'http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
                caption: 'Check out this video!',
                link: {
                    url: 'https://youtube.com/watch?v=dQw4w9WgXcQ', // Link to be shown in the story
                    text: 'Watch on YouTube'
                }
            });
        });

        // --- File Downloads ---
        document.getElementById('download_picture_btn').addEventListener('click', function() {
            Telegram.WebApp.downloadFile('https://picsum.photos/1000/1000', 'my_picture.jpg');
        });

        document.getElementById('download_video_btn').addEventListener('click', function() {
            Telegram.WebApp.downloadFile('http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4', 'my_video.mp4');
        });

        document.getElementById('download_pdf_btn').addEventListener('click', function() {
            Telegram.WebApp.downloadFile('https://www.africau.edu/images/default/sample.pdf', 'sample.pdf');
        });

        // --- Stickerpacks ---
        document.getElementById('add_stickerpack_btn').addEventListener('click', function() {
            // Replace with a valid stickerpack name, e.g., "Animals"
            Telegram.WebApp.addStickerpack('Animals', function(success) {
                if (success) {
                    Telegram.WebApp.showAlert('Stickerpack added successfully!');
                } else {
                    Telegram.WebApp.showAlert('Failed to add stickerpack.');
                }
            });
        });

        // --- Home Screen ---
        DemoApp.homeScreenInit = function() {
            const homeScreenStatusDiv = document.getElementById('home_screen_status');
            const checkHomeScreenBtn = document.getElementById('check_home_screen_btn');
            const addHomeScreenBtn = document.getElementById('add_home_screen_btn');

            function updateHomeScreenStatus() {
                if (Telegram.WebApp.isAddedToHomeScreen) {
                    homeScreenStatusDiv.innerText = 'Web App is already added to Home Screen.';
                    homeScreenStatusDiv.style.color = 'green';
                    addHomeScreenBtn.disabled = true;
                } else {
                    homeScreenStatusDiv.innerText = 'Web App is NOT added to Home Screen.';
                    homeScreenStatusDiv.style.color = 'red';
                    addHomeScreenBtn.disabled = false;
                }
            }

            checkHomeScreenBtn.addEventListener('click', updateHomeScreenStatus);
            addHomeScreenBtn.addEventListener('click', function() {
                Telegram.WebApp.addWebAppToHomeScreen();
                // Note: The isAddedToHomeScreen status might not update immediately after calling this.
                // It depends on user action.
                Telegram.WebApp.showAlert('Attempting to add to Home Screen...');
                setTimeout(updateHomeScreenStatus, 2000); // Check again after a short delay
            });

            // Initial check
            updateHomeScreenStatus();
        };

        // --- Emoji Status ---
        document.getElementById('set_emoji_status_btn').addEventListener('click', function() {
            const emoji = document.getElementById('emoji_status_input').value;
            const duration = parseInt(document.getElementById('emoji_status_duration').value);

            Telegram.WebApp.setEmojiStatus({
                emoji_id: emoji,
                expiration_date: duration > 0 ? Math.floor(Date.now() / 1000) + duration : 0
            }, function(success) {
                if (success) {
                    Telegram.WebApp.showAlert('Emoji status set!');
                } else {
                    Telegram.WebApp.showAlert('Failed to set emoji status.');
                }
            });
        });

        document.getElementById('request_emoji_status_access_btn').addEventListener('click', function() {
            Telegram.WebApp.requestEmojiStatusAccess(function(success) {
                if (success) {
                    Telegram.WebApp.showAlert('Emoji status access granted!');
                } else {
                    Telegram.WebApp.showAlert('Emoji status access denied.');
                }
            });
        });

        // --- Initialize all demo functions ---
        DemoApp.init = function() {
            try { DemoApp.testClipboard(document.getElementById('clipboard_test')); } catch(e) { console.error('Clipboard init error:', e); }
            try { DemoApp.loadCloudKeys(); } catch(e) { console.error('Cloud storage init error:', e); }
            try { DemoApp.biometricInit(); } catch(e) { console.error('Biometric init error:', e); }
            try { DemoApp.fullscreenInit(); } catch(e) { console.error('Fullscreen init error:', e); }
            try { DemoApp.accelerometerInit(); } catch(e) { console.error('Accelerometer init error:', e); }
            try { DemoApp.deviceOrientationInit(); } catch(e) { console.error('Device Orientation init error:', e); }
            try { DemoApp.gyroscopeInit(); } catch(e) { console.error('Gyroscope init error:', e); }
            try { DemoApp.locationInit(); } catch(e) { console.error('Location init error:', e); }
            try { DemoApp.homeScreenInit(); } catch(e) { console.error('Home Screen init error:', e); }
            // Ensure visibility after all initializations
            document.body.style.visibility = 'visible';
        };

        // Run initializations
        Telegram.WebApp.ready();
        DemoApp.init();

    </script>
</body>
    </html>
